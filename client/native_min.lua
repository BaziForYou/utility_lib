_G["ESX"],_G["xPlayer"],_G["source"],_G["developer"]=nil,{},GetPlayerServerId(PlayerId()),function()end;local a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s,t=AddTextEntry,BeginTextCommandDisplayHelp,EndTextCommandDisplayHelp,SetNotificationTextEntry,AddTextComponentSubstringPlayerName,DrawNotification,GetEntityCoords,World3dToScreen2d,SetTextScale,SetTextFont,SetTextEntry,SetTextCentre,AddTextComponentString,DrawText,DoesEntityExist,GetDistanceBetweenCoords,GetPlayerPed,TriggerEvent,TriggerServerEvent;local u=GetCurrentResourceName()local v={["ESC"]=322,["F1"]=288,["F2"]=289,["F3"]=170,["F5"]=166,["F6"]=167,["F7"]=168,["F8"]=169,["F9"]=56,["F10"]=57,["~"]=243,["1"]=157,["2"]=158,["3"]=160,["4"]=164,["5"]=165,["6"]=159,["7"]=161,["8"]=162,["9"]=163,["-"]=84,["="]=83,["BACKSPACE"]=177,["TAB"]=37,["Q"]=44,["W"]=32,["E"]=38,["R"]=45,["T"]=245,["Y"]=246,["U"]=303,["P"]=199,["["]=39,["]"]=40,["ENTER"]=18,["CAPS"]=137,["A"]=34,["S"]=8,["D"]=9,["F"]=23,["G"]=47,["H"]=74,["K"]=311,["L"]=182,["LEFTSHIFT"]=21,["Z"]=20,["X"]=73,["C"]=26,["V"]=0,["B"]=29,["N"]=249,["M"]=244,[","]=82,["."]=81,["LEFTCTRL"]=36,["LEFTALT"]=19,["SPACE"]=22,["RIGHTCTRL"]=70,["HOME"]=213,["PAGEUP"]=10,["PAGEDOWN"]=11,["DELETE"]=178,["LEFT"]=174,["RIGHT"]=175,["TOP"]=27,["DOWN"]=173,["NENTER"]=201,["N4"]=108,["N5"]=60,["N6"]=107,["N+"]=96,["N-"]=97,["N7"]=117,["N8"]=61,["N9"]=118}_G["Utility"]={Cache={PlayerPedId=PlayerPedId(),Marker={},Object={},Dialogue={},N3d={},Events={},Emitter={},SetData={},Frozen={},FlowDetector={},Constant={},Loop={},SliceGroups={}}}On=function(type,w,x)if string.find(type,"_change")then type=type..source end;local y={res=u,a=w,b=x}s("Utility:Create","Emitter",type,y,u)end;_G.old_TaskVehicleDriveToCoord=TaskVehicleDriveToCoord;TaskVehicleDriveToCoord=function(z,A,B,C,D)old_TaskVehicleDriveToCoord(z,A,B,C or 10.0,0,GetEntityModel(A),2883621,D or 1.0)end;_G.old_DisableControlAction=DisableControlAction;DisableControlAction=function(E,F)return old_DisableControlAction(0,v[string.upper(E)],true or F)end;DisableControlForSeconds=function(E,G)local H=G;Citizen.CreateThread(function()while H>0 do Citizen.Wait(1000)H=H-1 end;return end)Citizen.CreateThread(function()while H>0 do DisableControlAction(v[string.upper(E)])Citizen.Wait(1)end;return end)end;_G.old_IsControlJustPressed=IsControlJustPressed;IsControlJustPressed=function(I,J)developer("^2Created^0","key map",I)RegisterKeyMapping('utility '..u..' '..I,'',"keyboard",I)table.insert(Utility.Cache.Events,AddEventHandler("Utility:Pressed_"..u.."_"..I,J))end;ShowNotification=function(K)d('STRING')e(K)f(false,true)end;ButtonNotification=function(K)if string.match(K,"{.*}")then K=string.multigsub(K,{"{A}","{B}","{C}","{D}","{E}","{F}","{G}","{H}","{L}","{M}","{N}","{O}","{P}","{Q}","{R}","{S}","{T}","{U}","{V}","{W}","{X}","{Y}","{Z}"},{"~INPUT_VEH_FLY_YAW_LEFT~","~INPUT_SPECIAL_ABILITY_SECONDARY~","~INPUT_LOOK_BEHIND~","~INPUT_MOVE_LR~","~INPUT_CONTEXT~","~INPUT_ARREST~","~INPUT_DETONATE~","~INPUT_VEH_ROOF~","~INPUT_CELLPHONE_CAMERA_FOCUS_LOCK~","~INPUT_INTERACTION_MENU~","~INPUT_REPLAY_ENDPOINT~","~INPUT_FRONTEND_PAUSE~","~INPUT_FRONTEND_LB~","~INPUT_RELOAD~","~INPUT_MOVE_DOWN_ONLY~","~INPUT_MP_TEXT_CHAT_ALL~","~INPUT_REPLAY_SCREENSHOT~","~INPUT_NEXT_CAMERA~","~INPUT_MOVE_UP_ONLY~","~INPUT_VEH_HOTWIRE_LEFT~","~INPUT_VEH_DUCK~","~INPUT_MP_TEXT_CHAT_TEAM~","~INPUT_HUD_SPECIAL~"})end;a('ButtonNotification',K)b('ButtonNotification')c(0,false,true,-1)end;ButtonFor=function(K,L)local M=GetGameTimer()Citizen.CreateThread(function()while GetGameTimer()-M<(L or 5000)do ButtonNotification(K)Citizen.Wait(1)end end)end;FloatingNotification=function(K,N)a('FloatingNotification',K)SetFloatingHelpTextWorldPosition(1,N)SetFloatingHelpTextStyle(1,1,2,-1,3,0)b('FloatingNotification')c(2,false,false,-1)end;MakeEntityFaceEntity=function(O,P,Q)local R=g(O,true)local S=g(P,true)if Q then local T=GetHeadingFromVector_2d(S.x-R.x,S.y-R.y)SetEntityHeading(O,T)else local T=GetHeadingFromVector_2d(R.x-S.x,R.y-S.y)SetEntityHeading(P,T)end end;DrawText3Ds=function(N,U,V,W,X)if N then local Y,Z,_=h(N.x,N.y,N.z)if Y then i(V or 0.35,V or 0.35)j(W or 4)k("STRING")l(1)m(U)o(Z,_)if X then local a0=string.len(U)/370;local a1,a2=string.gsub(a0,"\n","\n")*0.025;if a2==nil then a2=0 end;DrawRect(Z,_+0.0125,0.025+a0,0.025+a2,0,0,0,90)end end end end;_G.old_TaskPlayAnim=TaskPlayAnim;TaskPlayAnim=function(z,a3,...)if not HasAnimDictLoaded(a3)then RequestAnimDict(a3)while not HasAnimDictLoaded(a3)do Citizen.Wait(1)end end;old_TaskPlayAnim(z,a3,...)RemoveAnimDict(a3)end;TaskEasyPlayAnim=function(a4,a5,a6,a7)if a6==nil then a6=51 end;if a7==nil then a7=-1 end;TaskPlayAnim(PlayerPedId(),a4,a5,2.0,2.0,a7,a6,0)if a7>-1 or a7>0 then Citizen.Wait(a7)end end;_G.old_CreateObject=CreateObject;CreateObject=function(a8,...)if type(a8)=="string"then a8=GetHashKey(a8)end;if not HasModelLoaded(a8)then RequestModel(a8)while not HasModelLoaded(a8)do Citizen.Wait(1)end end;local a9=old_CreateObject(a8,...)SetModelAsNoLongerNeeded(a8)local aa=0;if NetworkGetEntityIsNetworked(a9)then aa=ObjToNet(a9)SetNetworkIdExistsOnAllMachines(aa,true)SetNetworkIdCanMigrate(aa,true)end;return a9,aa end;_G.old_CreatePed=CreatePed;CreatePed=function(a8,...)if type(a8)=="string"then a8=GetHashKey(a8)end;if not HasModelLoaded(a8)then RequestModel(a8)while not HasModelLoaded(a8)do Citizen.Wait(1)end end;local z=old_CreatePed(0,a8,...)SetModelAsNoLongerNeeded(a8)local aa=0;if NetworkGetEntityIsNetworked(z)then aa=PedToNet(z)SetNetworkIdExistsOnAllMachines(aa,true)SetNetworkIdCanMigrate(aa,true)end;return z,aa end;SetPedStatic=function(ab,ac)FreezeEntityPosition(ab,ac)SetEntityInvincible(ab,ac)SetBlockingOfNonTemporaryEvents(ab,ac)end;_G.old_CreateVehicle=CreateVehicle;CreateVehicle=function(a8,...)if type(a8)=="string"then a8=GetHashKey(a8)end;if not HasModelLoaded(a8)then RequestModel(a8)while not HasModelLoaded(a8)do Citizen.Wait(1)end end;local ad=old_CreateVehicle(a8,...)SetModelAsNoLongerNeeded(a8)local aa=0;if NetworkGetEntityIsNetworked(ad)then aa=VehToNet(ad)SetNetworkIdExistsOnAllMachines(aa,true)SetNetworkIdCanMigrate(aa,true)end;return ad,aa end;_G.old_DeleteEntity=DeleteEntity;DeleteEntity=function(ab,ae)if not ae then NetworkRequestControlOfEntity(ab)while not NetworkRequestControlOfEntity(ab)do Citizen.Wait(1)end;if not IsEntityAMissionEntity(ab)then SetEntityAsMissionEntity(ab)end;old_DeleteEntity(ab)else NetworkRequestControlOfNetworkId(ab)local af=NetworkGetEntityFromNetworkId(ab)while not NetworkRequestControlOfEntity(af)do Citizen.Wait(1)end;SetEntityAsMissionEntity(af)old_DeleteEntity(af)end end;_G.old_RegisterNetEvent=RegisterNetEvent;RegisterNetEvent=function(ag,ah)old_RegisterNetEvent(ag)AddEventHandler(ag,ah)end;_G.old_GetPlayerName=GetPlayerName;GetPlayerName=function(ai)return old_GetPlayerName(ai or PlayerId())end;_G.old_PlayerPedId=PlayerPedId;PlayerPedId=function()if not p(Utility.Cache.PlayerPedId)then Utility.Cache.PlayerPedId=old_PlayerPedId()end;return Utility.Cache.PlayerPedId end;StopLoop=function(ai)Utility.Cache.Loop[ai].status=false end;CreateLoop=function(J,aj,ak)local al=RandomId(5)Utility.Cache.Loop[al]={status=true,func=J,tick=aj}if ak~=false then Citizen.CreateThread(function()while Utility.Cache.Loop[al]and Utility.Cache.Loop[al].status do J(al)Citizen.Wait(aj or 1)end end)end;return al end;PauseLoop=function(al,am)Citizen.SetTimeout(am or 0,function()print("Pausing loop "..al)Utility.Cache.Loop[al].status=false end)end;ResumeLoop=function(al,am)local an=Utility.Cache.Loop[al]Citizen.SetTimeout(am or 0,function()print("Resuming loop "..al)an.status=true;Citizen.CreateThread(function()while an and an.status do an.func(al)Citizen.Wait(an.tick or 1)end end)end)end;GetWorldClosestPed=function(ao)local ap=0;local aq=GetGamePool("CPed")local N=g(PlayerPedId())local ar=ao+5.0;for as=1,#aq do local at=q(N,g(aq[as]),false)if at<=ao and aq[as]~=PlayerPedId()then if ar>at then ar=at;ap=aq[as]end end end;return ap,aq end;GetWorldClosestPlayer=function(ao)local ap=0;local au={}local ar=ao+5.0;local aq=GetGamePool("CPed")local N=g(PlayerPedId())for as=1,#aq do if IsPedAPlayer(aq[as])then table.insert(au,NetworkGetPlayerIndexFromPed(aq[as]))local at=q(N,g(aq[as]),false)if at<=ao and aq[as]~=PlayerPedId()then if ar>at then ar=at;ap=NetworkGetPlayerIndexFromPed(aq[as])end end end end;return ap,au end;GetEntitySurfaceMaterial=function(ab)local N=GetEntityCoords(ab)local av=StartShapeTestCapsule(N.x,N.y,N.z,N.x,N.y,N.z-2.5,2,1,ab,7)local a1,aw,a1,a1,ax=GetShapeTestResultIncludingMaterial(av)return ax,aw end;GetLoadoutOfPed=function(z)local ay=ESX.GetWeaponList()local az={}for as=1,#ay,1 do local hash=GetHashKey(ay.name)if HasPedGotWeapon(z,hash,false)then table.insert(az,{name=ay.name,hash=hash,ammo=GetAmmoInPedWeapon(z,hash)})end end;return az end;local aA=FreezeEntityPosition;FreezeEntityPosition=function(ab,ac)Utility.Cache.Frozen[ab]=ac;aA(ab,ac)end;IsEntityFrozen=function(ab)return Utility.Cache.Frozen[ab]==true end;GetNearestValue=function(aB,aC)local aD=100*100000000000;local aE=0;for as=1,#aC do local aF=math.abs(aC[as]-aB)if aF<aD then aD=aF;n=aC[as]aE=as end end;return n,aD,aE end;TriggerSyncedEvent=function(aG,aH,...)if type(aH)=="number"or type(aH)=="table"then if aH==-1 then t("Utility:SyncEvent",aG,"",...)else t("Utility:SyncEvent",aG,aH,...)end else developer("^1Error^0","you can use only number/table on whitelist of TriggerSyncedEvent","")end end;StartESX=function(ag,aI)Citizen.CreateThreadNow(function()while ESX==nil do TriggerEvent(ag or'esx:getSharedObject',function(a9)ESX=a9 end)Citizen.Wait(1)end;while ESX.GetPlayerData().job==nil do Citizen.Wait(1)end;xPlayer=ESX.GetPlayerData()if aI~=nil then while ESX.GetPlayerData()[aI]==nil do Citizen.Wait(1)end;xPlayer=ESX.GetPlayerData()end;if aI~=nil then RegisterNetEvent('esx:set'..string.upper(aI:sub(1,1))..aI:sub(2),function(aJ)xPlayer[aI]=aJ end)end;RegisterNetEvent('esx:setJob',function(aJ)xPlayer.job=aJ end)end)end;StartQB=function(aK)QBCore=exports['qb-core']:GetCoreObject()end;GetDataForJob=function(aJ)local aL=promise:new()if GetResourceState("es_extended")=="started"then ESX.TriggerServerCallback("Utility:GetJobData",function(aM)aL:resolve(aM)end,aJ)elseif GetResourceState("qb-core")=="started"then QBCore.Functions.TriggerCallback("Utility:GetJobData",function(aM)aL:resolve(aM)end,aJ)end;aL=Citizen.Await(aL)return#aL,aL end;local aN=0;GetOnHandObject=function()return aN end;TakeObjectOnHand=function(z,aO,aP,aQ,aR,aS,aT,aU,aV)developer("^2Taking^0","object",aO.." ("..GetEntityModel(aO)..")")if type(aO)=="number"then TaskPlayAnim(z,"anim@heists@box_carry@","idle",3.0,3.0,-1,63,0,0,0,0)Citizen.Wait(100)AttachEntityToEntity(aO,z,GetPedBoneIndex(z,60309),aQ or 0.2,aR or 0.08,aS or 0.2,aT or-45.0,aU or 290.0,aV or 0.0,true,true,false,true,1,true)aN=aO elseif type(aO)=="string"then local N=g(z)local aW=CreateObject(aO,N+vector3(0.0,0.0,aP or 0.2),true,false,false)SetEntityAsMissionEntity(aW)TaskPlayAnim(z,"anim@heists@box_carry@","idle",3.0,-8,-1,63,0,0,0,0)Citizen.Wait(100)AttachEntityToEntity(aW,z,GetPedBoneIndex(z,60309),aQ or 0.2,aR or 0.08,aS or 0.2,aT or-45.0,aU or 290.0,aV or 0.0,true,true,false,true,1,true)aN=aW;return aW end end;DropObjectFromHand=function(aX,aY)if aY then developer("^1Deleting^0","from hand",aX)DeleteEntity(aX)else developer("^3Dont delete^0","from hand",aX)DetachEntity(aX)SetEntityCoords(aX,GetOffsetFromEntityInWorldCoords(aX,0,0.5,0))PlaceObjectOnGroundProperly(aX)FreezeEntityPosition(aX,true)end;ClearPedTasks(PlayerPedId())aN=0 end;IsInRadius=function(R,S,ao,aZ)local at=#(R-S)if aZ then DrawSphere(S,ao,255,0,0,0.5)end;return at<ao end;IsNearCoords=function(N,ao,aZ)local at=#(GetEntityCoords(PlayerPedId())-N)if aZ then DrawSphere(N,ao,255,0,0,0.5)end;return at<ao end;GenerateRandomCoords=function(N,ao,T)local a_=N.x+math.random(-ao,ao)local b0=N.y+math.random(-ao,ao)local a1,b1=GetGroundZFor_3dCoord(a_,b0,200.0,0)if T then return vector3(a_,b0,b1),math.random(0.0,360.0)end;return vector3(a_,b0,b1)end;SetFor=function(ai,b2,b3)if Utility.Cache["SetData"][ai]==nil then Utility.Cache["SetData"][ai]={}end;if type(b2)=="table"then for b4,aB in pairs(b2)do developer("^2Setting^0","data","("..ai..") ["..b4 .." = "..json.encode(aB).."] {table}")Utility.Cache["SetData"][ai][b4]=aB end else developer("^2Setting^0","data","("..ai..") ["..b2 .." = "..json.encode(b3).."] {single}")Utility.Cache["SetData"][ai][b2]=b3 end end;GetFrom=function(ai,b2)if b2==nil then b2="not defined"end;developer("^3Getting^0","data","("..ai..") ["..b2 .."]")if Utility.Cache["SetData"][ai]~=nil then if b2=="not defined"then return Utility.Cache["SetData"][ai]else return Utility.Cache["SetData"][ai][b2]end else return nil end end;function GetSliceCoordsFromCoords(b5)return vector2(math.floor((b5.x+8192)/100),math.floor((b5.y+8192)/100))end;function GetSliceFromCoords(b6)local b7=GetSliceCoordsFromCoords(b6)local ai=b7.x*math.pow(2,2)+b7.y;return ai end;function GetEntitySlice(z)return GetSliceFromCoords(GetEntityCoords(z))end;function GetPlayerSlice(b8)local z=GetPlayerPed(b8)return GetSliceFromCoords(GetEntityCoords(z))end;function GetSelfSlice()local z=PlayerPedId()return GetSliceFromCoords(GetEntityCoords(z))end;function IsOnScreen(N)local Y,Z,_=World3dToScreen2d(N.x,N.y,N.z)return Y end;function SliceUsed(b7)return Utility.Cache.SliceGroups[b7]or false end;function SetSliceUsed(b7,b3)Utility.Cache.SliceGroups[b7]=b3 end;RandomId=function(b9)b9=b9 or 5;local ba=""for as=1,b9 do ba=ba.."9"end;return math.random(0,ba)end;CreateMarker=function(ai,N,bb,bc,bd)if DoesExist("m",ai)then Citizen.Wait(100)return else if type(N)~="vector3"then developer("^1Error^0","You can use only vector3 for coords!",ai)return end;ai=string.gsub(ai,"{r}",RandomId())developer("^2Created^0","Marker",ai)local be={render_distance=bb,interaction_distance=bc,coords=N,slice=tostring(GetSliceFromCoords(N))}if type(bd)=="table"then if bd.rgb~=nil then be.type=1;be.rgb=bd.rgb elseif bd.text~=nil then be.type=0;be.text=bd.text else be.type=1;be.rgb={bd[1],bd[2],bd[3]}end;if bd.type~=nil and type(bd.type)=="number"then be._type=bd.type end;if bd.direction~=nil and type(bd.direction)=="vector3"then be._direction=bd.direction end;if bd.rotation~=nil and type(bd.rotation)=="vector3"then be._rot=bd.rotation end;if bd.scale~=nil and type(bd.scale)=="vector3"then be._scale=bd.scale end;if bd.alpha~=nil and type(bd.alpha)=="number"then be.alpha=bd.alpha end;if bd.animation~=nil and type(bd.animation)=="boolean"then be.anim=bd.animation end;if bd.job~=nil then be.job=bd.job end;if bd.notify~=nil then local bf=string.multigsub(bd.notify,{"{A}","{B}","{C}","{D}","{E}","{F}","{G}","{H}","{L}","{M}","{N}","{O}","{P}","{Q}","{R}","{S}","{T}","{U}","{V}","{W}","{X}","{Y}","{Z}"},{"~INPUT_VEH_FLY_YAW_LEFT~","~INPUT_SPECIAL_ABILITY_SECONDARY~","~INPUT_LOOK_BEHIND~","~INPUT_MOVE_LR~","~INPUT_CONTEXT~","~INPUT_ARREST~","~INPUT_DETONATE~","~INPUT_VEH_ROOF~","~INPUT_CELLPHONE_CAMERA_FOCUS_LOCK~","~INPUT_INTERACTION_MENU~","~INPUT_REPLAY_ENDPOINT~","~INPUT_FRONTEND_PAUSE~","~INPUT_FRONTEND_LB~","~INPUT_RELOAD~","~INPUT_MOVE_DOWN_ONLY~","~INPUT_MP_TEXT_CHAT_ALL~","~INPUT_REPLAY_SCREENSHOT~","~INPUT_NEXT_CAMERA~","~INPUT_MOVE_UP_ONLY~","~INPUT_VEH_HOTWIRE_LEFT~","~INPUT_VEH_DUCK~","~INPUT_MP_TEXT_CHAT_TEAM~","~INPUT_HUD_SPECIAL~"})be.notify=bf end elseif type(bd)=="string"then be.type=0;be.text=bd end;Utility.Cache.Marker[ai]=be;s("Utility:Create","Marker",ai,be)end end;SetMarker=function(ai,bg,I,b3)if type(b3)~=bg then developer("^1Error^0",I.." can be only a "..bg,"[Marker]")return end;if DoesExist("marker",ai)then Utility.Cache.Marker[ai][I]=b3;s("Utility:Edit","Marker",ai,I,b3)else developer("^1Error^0","Unable to edit the marker as it does not exist",ai)end end;SetMarkerType=function(ai,bg)SetMarker(ai,"number","_type",bg)end;SetMarkerDirection=function(ai,bh)SetMarker(ai,"vector3","_direction",bh)end;SetMarkerRotation=function(ai,bi)SetMarker(ai,"vector3","_rot",bi)end;SetMarkerScale=function(ai,V)SetMarker(ai,"vector3","_scale",V)end;SetMarkerColor=function(ai,bj)SetMarker(ai,"table","rgb",bj)end;SetMarkerCoords=function(ai,N)SetMarker(ai,"vector3","coords",N)end;SetMarkerRenderDistance=function(ai,bb)SetMarker(ai,"number","render_distance",bb)end;SetMarkerInteractionDistance=function(ai,bc)SetMarker(ai,"number","interaction_distance",bc)end;SetMarkerAlpha=function(ai,bk)SetMarker(ai,"number","alpha",bk)end;SetMarkerAnimation=function(ai,ac)SetMarker(ai,"boolean","anim",ac)end;SetMarkerDrawOnEntity=function(ai,ac)SetMarker(ai,"boolean","draw_entity",ac)end;Set3dText=function(ai,U)SetMarker(ai,"string","text",U)end;Set3dTextScale=function(ai,V)SetMarker(ai,"number","_scale",V)end;Set3dTextDrawRect=function(ai,ac)SetMarker(ai,"boolean","rect",ac)end;Set3dTextFont=function(ai,W)SetMarker(ai,"number","font",W)end;DeleteMarker=function(ai)if not DoesExist("m",ai)then Citizen.Wait(100)return else developer("^1Deleted^0","Marker",ai)Utility.Cache.Marker[ai]=nil;s("Utility:Remove","Marker",ai)end end;CreateiObject=function(ai,bl,b6,T,bc,bm,aJ)developer("^2Created^0 Object "..ai.." ("..bl..")")local a9;if bm~=nil then a9=CreateObject(GetHashKey(bl),b6.x,b6.y,b6.z,bm,false,false)or nil else a9=CreateObject(GetHashKey(bl),b6.x,b6.y,b6.z,true,false,false)or nil end;SetEntityHeading(a9,T)SetEntityAsMissionEntity(a9,true,true)FreezeEntityPosition(a9,true)SetModelAsNoLongerNeeded(hash)_object={obj=a9,coords=b6,interaction_distance=bc or 3.0,slice=tostring(GetSliceFromCoords(b6)),job=aJ}Utility.Cache.Object[ai]=_object;s("Utility:Create","Object",ai,_object)return a9,g(a9)end;DeleteiObject=function(ai,aY)developer("^1Deleted^0","Object",ai)if aY then DeleteEntity(Utility.Cache.Object[ai].obj)end;Utility.Cache.Object[ai]=nil;s("Utility:Remove","Object",ai)end;CreateBlip=function(bn,N,bo,bp,V)developer("^2Created^0","Blip",bn)local bq=AddBlipForCoord(N)SetBlipSprite(bq,bo)SetBlipScale(bq,V or 1.0)SetBlipColour(bq,bp)SetBlipAsShortRange(bq,true)BeginTextCommandSetBlipName('STRING')e(bn)EndTextCommandSetBlipName(bq)return bq end;SetIdOf=function(type,ai,br)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;if DoesExist(type,ai)then Utility.Cache[type][br]=Utility.Cache[type][ai]Utility.Cache[type][ai]=nil else developer("^1Error^0","Unable to set id of the "..type.." as it does not exist",ai)return end;developer("^3Change^0","Setted id to "..br.." of the id",ai)s("Utility:Remove",type,ai)s("Utility:Create",type,br,Utility.Cache[type][br])end;GetDistanceFrom=function(type,ai)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;local at=0.0;if Utility.Cache[type][ai].coords~=nil then return q(g(PlayerPedId()),Utility.Cache[type][ai].coords,true)else return false end end;GetCoordOf=function(type,ai)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;if DoesExist(type,ai)then return Utility.Cache[type][ai].coords else developer("^1Error^0","Unable to get the coords of the id",ai)return false end end;DoesExist=function(type,ai)if type:lower()=="marker"or type:lower()=="m"then type="Marker"elseif type:lower()=="object"or type:lower()=="o"then type="Object"else return nil end;if Utility.Cache[type][ai]~=nil then return true else return false end end;CreateCamera=function(N,bs,ac,bt)local bu=CreateCam("DEFAULT_SCRIPTED_CAMERA",true)SetCamCoord(bu,N)if bs~=nil then SetCamRot(bu,bs.x,bs.y,bs.z)end;if bt~=nil then ShakeCam(bu,bt.type or"",bt.amount or 0.0)end;if ac then SetCamActive(bu,true)RenderScriptCams(1,1,1500)end;return bu end;SwitchBetweenCam=function(bv,bu,a7)SetCamActiveWithInterp(bu,bv,a7 or 1500,1,1)Citizen.Wait(a7 or 1500)DestroyCam(bv)end;DevMode=function(bw,bx,by)if bx==nil then bx=true end;by=by or"%s %s %s"if bw then developer=function(bz,type,ai)local a1,a1,a1,bA,bB,bC=GetLocalTime()if bx then if type==nil then print(bA..":"..bB..":"..bC.." - "..bz)else print(bA..":"..bB..":"..bC.." - "..string.format(by,bz,type,ai))end else if type==nil then print(bz)else print(string.format(by,bz,type,ai))end end end else developer=function()end end end;ReplaceTexture=function(aW,bD,bE,bF,bG)local bH=CreateRuntimeTxd('duiTxd')local bI=CreateDui(bE,bF,bG)local bJ=GetDuiHandle(bI)local bK=CreateRuntimeTextureFromDuiHandle(bH,'duiTex',bJ)AddReplaceTexture(aW,bD,'duiTxd','duiTex')end;printd=function(bL,bM)if bM then local bN={}local function bO(bP,bQ)if bN[tostring(bP)]then print(bQ.."*"..tostring(bP))else bN[tostring(bP)]=true;if type(bP)=="table"then for b6,bR in pairs(bP)do if type(bR)=="table"then print(bQ.."["..b6 .."] => "..tostring(bP).." {")bO(bR,bQ..string.rep(" ",string.len(b6)+8))print(bQ..string.rep(" ",string.len(b6)+6).."}")elseif type(bR)=="string"then print(bQ.."["..b6 .."] => \""..bR.."\"")else print(bQ.."["..b6 .."] => "..tostring(bR))end end else print(bQ..tostring(bP))end end end;if type(bL)=="table"then print(tostring(bL).." {")bO(bL,"  ")print("}")else developer("^1Error^0","error dumping table "..bL.." why isnt a table","")end else if type(bL)=="table"then print(json.encode(bL,{indent=true}))else developer("^1Error^0","error dumping table "..bL.." why isnt a table","")end end end;local bS=string.gsub;string.multigsub=function(string,table,bT)if type(table)then for as=1,#table do string=bS(string,table[as],bT[as])end else for as=1,#table do string=bS(string,table[as],bT)end end;return string end;table.fexist=function(bL,bU)bL=bL[bU]if not bL then return false else return true end end;local bV=table.remove;table.remove=function(bL,bW,bX)if type(bW)=="number"then bV(bL,bW)elseif type(bW)=="string"then for b4,aB in pairs(bL)do if b4==bW then bL[b4]=nil;if bX then break end end end end end;table.empty=function(bL)return next(bL)==nil end;table.clone=function(bL)bL.metatable={__index=bL}local bY={}setmetatable(bY,bL.metatable)return bY end;local function bZ(ab,_dialog,b_)return{Question=function(...)local c0={...}_dialog.questions=c0;return{Response=function(...)local c1={}local c2={}for c3,c4 in pairs({...})do c2[c3]={}for b4,aB in pairs(c4)do if c1[c3]==nil then c1[c3]=""end;c1[c3]=c1[c3]..b4 .."~w~ "..aB.." | "b4=string.multigsub(b4,{"%[","%]"},{"",""})b4=string.multigsub(b4,{"~r~","~b~","~g~","~y~","~p~","~o~","~c~","~m~","~u~","~n~","~s~","~w~"},{"","","","","","","","","","","",""})c2[c3][b4]=aB end;c1[c3]=c1[c3]:sub(1,-3)end;_dialog.response={no_formatted=c2,formatted=c1}if b_ then s("Utility:Remove","Dialogue",ab)s("Utility:Create","Dialogue",ab,_dialog)else s("Utility:Create","Dialogue",ab,_dialog)end;Utility.Cache.Dialogue[ab]=_dialog;return{LastQuestion=function(c5)Utility.Cache.Dialogue[ab].lastq=c5;s("Utility:Edit","Dialogue",ab,"lastq",c5)end}end}end}end;StartDialogue=function(ab,at,c6)local _dialog={}_dialog={entity=ab,distance=at,current_question=1,callback=c6,slice=tostring(GetEntitySlice(ab))}developer("^2Created^0","dialogue with entity",ab)return bZ(ab,_dialog)end;EditDialogue=function(ab)if ab~=nil and IsEntityOnDialogue(ab)then return bZ(ab,_dialog,true)end end;StopDialogue=function(ab)if ab~=nil and IsEntityOnDialogue(ab)then developer("^1Stopping^0","dialogue",ab)if Utility.Cache.Dialogue[ab].lastq~=nil then local c7=0;local c8=Utility.Cache.Dialogue[ab].lastq;local c9=Utility.Cache.Dialogue[ab].entity;local ca=GetEntityCoords(c9)+vector3(0.0,0.0,1.0)local cb=false;Citizen.SetTimeout(3000,function()ca=nil;cb=true end)CreateLoop(function(al)ca=GetEntityCoords(_entity)+vector3(0.0,0.0,1.0)if cb then ca=nil;StopLoop(al)end;DrawText3Ds(ca,c8,nil,nil,true)end)end;Utility.Cache.Dialogue[ab]=nil;s("Utility:Remove","Dialogue",ab)end end;RegisterNetEvent("Utility_Native:ResyncDialogue",function(ab)Utility.Cache.Dialogue[ab]=nil end)IsEntityOnDialogue=function(ab)return Utility.Cache.Dialogue[ab]end;local function cc(table)local cd={}print("Copying table "..tostring(table))for b4,aB in pairs(table)do cd[b4]=aB end;return cd end;CreateLoop(function()for bn,ce in pairs(Utility.Cache.FlowDetector)do local cf=_G[bn]if type(cf)=='table'or type(ce)=='table'then if json.encode(ce)~=json.encode(cf)then print("\nDetected old_value change of syncedV \""..bn.."\" from \""..json.encode(ce).."\" to \""..json.encode(cf).."\"")TriggerSyncedEvent("Utility:SyncValue_emit",-1,bn,ce,cf)TriggerSyncedEvent("Utility:SyncValue["..u.."]",-1,bn,cf)local cd=cc(cf)Utility.Cache.FlowDetector[bn]=cd end else if cf~=ce then TriggerSyncedEvent("Utility:SyncValue_emit",-1,bn,ce,cf)TriggerSyncedEvent("Utility:SyncValue["..u.."]",-1,bn,cf)Utility.Cache.FlowDetector[bn]=cf end end end end,2000)Synced=function(bn,b3)print("Creating synceV "..bn)if type(b3)=="table"then local cd=cc(b3)Utility.Cache.FlowDetector[bn]=cd;_G[bn]=b3 else Utility.Cache.FlowDetector[bn]=b3;_G[bn]=b3 end end;RegisterNetEvent("Utility:SyncValue["..u.."]",function(bn,b3)_G[bn]=b3 end)local function cg(ch,ci)local cj=RequestScaleformMovie(ci)local c7=100;while not HasScaleformMovieLoaded(cj)and c7>0 do c7=c7-1;cj=RequestScaleformMovie(ci)Citizen.Wait(5)end;if c7==0 then developer("^1Error^0","After 100 attempts to load the scaleform the scaleform has not loaded yet, try again or check that it has started correctly!","")return end;Utility.Cache.N3d[ch].scaleform=cj;s("Utility:Edit","N3d",ch,"scaleform",cj)end;local function ck(ch,bE,bF,bG)local bH=CreateRuntimeTxd('txd')Utility.Cache.N3d[ch].dui=CreateDui(bE,bF,bG)s("Utility:Edit","N3d",ch,"dui",Utility.Cache.N3d[ch].dui)local bJ=GetDuiHandle(Utility.Cache.N3d[ch].dui)CreateRuntimeTextureFromDuiHandle(bH,'txn',bJ)if Utility.Cache.N3d[ch].scaleform~=nil and not Utility.Cache.N3d[ch].txd then PushScaleformMovieFunction(Utility.Cache.N3d[ch].scaleform,'SET_TEXTURE')PushScaleformMovieMethodParameterString('txd')PushScaleformMovieMethodParameterString('txn')PushScaleformMovieFunctionParameterInt(0)PushScaleformMovieFunctionParameterInt(0)PushScaleformMovieFunctionParameterInt(bF)PushScaleformMovieFunctionParameterInt(bG)PopScaleformMovieFunctionVoid()Utility.Cache.N3d[ch].txd=true;s("Utility:Edit","N3d",ch,"txd",true)end end;function CreateNui3d(cl,bE)local ch=tostring(math.random(0,9999))local cm={txd=false,show=false,rotation={}}Utility.Cache.N3d[ch]=cm;s("Utility:Create","N3d",ch,cm)cg(ch,cl)if bE~=nil then ck(ch,"nui://"..GetCurrentResourceName().."/"..bE,1920,1080)end;local cn={}cn.__index=cn;cn.init=function(self,bE,bF,bG)ck(ch,"nui://"..GetCurrentResourceName().."/"..bE,bF or 1920,bG or 1080)end;cn.scale=function(self,V)Utility.Cache.N3d[ch].advanced_scale=V;s("Utility:Edit","N3d",ch,"advanced_scale",V)end;cn.rotation=function(self,bs,co)Utility.Cache.N3d[ch].rotation.rotation=bs;Utility.Cache.N3d[ch].rotation.syncedwithplayer=co;s("Utility:Edit","N3d",ch,"rotation",{rotation=bs,syncedwithplayer=co})end;cn.destroy=function(self)if Utility.Cache.N3d[ch].dui~=nil then DestroyDui(Utility.Cache.N3d[ch].dui)SetScaleformMovieAsNoLongerNeeded(cl)s("Utility:Remove","N3d",ch)end end;cn.started=function()return Utility.Cache.N3d[ch].dui~=nil end;cn.show=function(self,N,V)Utility.Cache.N3d[ch].coords=N;Utility.Cache.N3d[ch].scale=V or 0.1;Utility.Cache.N3d[ch].show=true;s("Utility:Edit","N3d",ch,"coords",N)s("Utility:Edit","N3d",ch,"scale",V or 0.1)s("Utility:Edit","N3d",ch,"show",true)end;cn.visible=function()return Utility.Cache.N3d[ch].show end;cn.hide=function()Utility.Cache.N3d[ch].show=false;s("Utility:Edit","N3d",ch,"show",false)end;cn.attach=function(self,ab,cp)Utility.Cache.N3d[ch].attach={entity=ab,offset=cp or vector3(0.0,0.0,0.0)}s("Utility:Edit","N3d",ch,"attach",{entity=ab,offset=cp or vector3(0.0,0.0,0.0)})end;cn.detach=function(self,cq)if cq then Utility.Cache.N3d[ch].coords=GetEntityCoords(Utility.Cache.N3d[ch].attach.entity)s("Utility:Edit","N3d",ch,"coords",Utility.Cache.N3d[ch].coords)end;Utility.Cache.N3d[ch].attach=nil;s("Utility:Edit","N3d",ch,"attach",nil)end;cn.object=function()return Utility.Cache.N3d[ch].dui end;cn.msg=function(self,K)if self:started()then SendDuiMessage(self:object(),json.encode(K))end end;return setmetatable({},cn)end;AddEventHandler("onResourceStop",function(cr)if cr==u then for as=1,#Utility.Cache.Events do RemoveEventHandler(Utility.Cache.Events[as])end;for cs,ct in pairs(Utility.Cache.N3d)do if ct.dui~=nil then DestroyDui(ct.dui)s("Utility:Remove","N3d",cs)end end end end)GetDirectionFromVectors=function(cu,cv)return cu-cv end;RotationToDirection=function(bs)local cw={x=math.pi/180*bs.x,y=math.pi/180*bs.y,z=math.pi/180*bs.z}local bh={x=-math.sin(cw.z)*math.abs(math.cos(cw.x)),y=math.cos(cw.z)*math.abs(math.cos(cw.x)),z=math.sin(cw.x)}return vector3(bh.x,bh.y,bh.z)end;TranslateZAnimated=function(a9,b1,cx)local N=GetEntityCoords(a9)local cy=b1<0;for as=1,math.abs(b1)*100 do local cz=cy and N.z-as/100 or N.z+as/100;SetEntityCoords(a9,N.x,N.y,cz)Citizen.Wait(cx)end end;SetVehicleWheelsPowered=function(ad,ac)for as=0,GetVehicleNumberOfWheels(ad)-1 do SetVehicleWheelIsPowered(ad,as,ac)end end;CreateInteraction=function(ai,N,cA,bb,bc)developer("^2Created^0","Interaction",ai)exports["utility_interaction"]:CreateInteraction(ai,N,cA,bb,bc)end;DeleteInteraction=function(ai)developer("^1Deleted^0","Interaction",ai)exports["utility_interaction"]:DeleteInteraction(ai)end;ShowUtilityNotification=function(cB,cC,cD,cE,a7)exports["utility_notify"]:show(cB,cC,cD,cE,a7)end;CreateMissionText=function(K,a7)SetTextEntry_2("STRING")AddTextComponentString(K)DrawSubtitleTimed(a7 or 60000*240,1)return{delete=function()ClearPrints()end}end;WaitNear=function(N)local b8=PlayerPedId()while#(GetEntityCoords(b8)-N)>10 do Citizen.Wait(100)end end;apairs=function(bP,cF)local c7={}local as=0;for b4 in pairs(bP)do table.insert(c7,b4)end;table.sort(c7,cF)local cG=function()as=as+1;if c7[as]==nil then return nil else return c7[as],bP[c7[as]]end end;return cG end;FindInTable=function(table,U)for as=1,#table do if table[as]==U then return as end end;return nil end;GetRandom=function(table)local cH=math.random(1,#table)return table[cH]end;Probability=function(cI)return math.random()+math.random(0,99)<=cI end;AddPercentage=function(cI,cJ)return cI+cI*cJ/100 end;RemovePercentage=function(cI,cJ)return cI-cI*cJ/100 end
